#!/usr/bin/env bash
set -uo pipefail

if pgrep -x hyprshot >/dev/null || pgrep -x slurp >/dev/null; then
    killall -9 hyprshot slurp hyprpicker grim 2>/dev/null || true
    exit 0
fi

MODE="${1:-}"
FILENAME="screenshot_$(date +%s).png"
IMG_PATH="/tmp/$FILENAME"

rm -f /tmp/screenshot_*.png

if [[ "$MODE" == "region" ]]; then
    hyprshot -m region --freeze -s -o /tmp -f "$FILENAME"
else
    hyprshot -m "$MODE" -s -o /tmp -f "$FILENAME"
fi

pkill -x rofi || true

if [[ -f "$IMG_PATH" ]]; then
    command -v makenotif >/dev/null && makenotif hyprshot "$IMG_PATH" Hyprshot "Captured $MODE to clipboard!" true camera-shutter.oga
fi
