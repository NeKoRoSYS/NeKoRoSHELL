#!/usr/bin/env bash
set -euo pipefail

HYPRGAMEMODE=$(hyprctl getoption animations:enabled | awk 'NR==1{print $2}')

if [ "$HYPRGAMEMODE" = 1 ] ; then
    hyprctl --batch "\
        keyword animations:enabled 0;\
        keyword decoration:drop_shadow 0;\
        keyword decoration:blur:enabled 0;\
        keyword general:gaps_in 0;\
        keyword general:gaps_out 0;\
        keyword general:border_size 1;\
        keyword decoration:rounding 0"
    
    pkill -x mpvpaper || true
    swww kill || pkill -x swww-daemon || true
    
    command -v makenotif >/dev/null && makenotif customize dialog-information "Performance Mode" "Visuals and wallpapers disabled."
else
    hyprctl reload
    
    (
        sleep 1
        VIDEO_CACHE="${XDG_CACHE_HOME:-$HOME/.cache}/nekoroshell/video_wallpaper"
        
        if [ -f "$VIDEO_CACHE" ] && [ -x "$HOME/.config/hypr/scripts/wallpapers/check-video.sh" ]; then
            "$HOME/.config/hypr/scripts/wallpapers/check-video.sh"
        fi

        if command -v swww-daemon >/dev/null 2>&1; then
            swww-daemon --format argb &
        fi
    ) &
    
    command -v makenotif >/dev/null && makenotif customize dialog-information "Standard Mode" "Visuals and wallpapers restored."
fi
